Задание 1

function hello() {
  console.log('Skill');
}
try { 
  helo();
} catch (error) {
  console.error(error);
}
console.log('complete');



Задание 2

function greeting() {
  const username = prompt("Введите имя пользователя");
  if (username === null || username.trim() === '') {
      throw new Error('Имя обязательно для заполнения');
  }
}
try { 
  greeting();
} catch(error) { 
  alert(error.message);
}



Задание 3

function globalError() {
  const error = Error('Глобальная ошибка');
  error.name = 'GlobalError';
  throw error;
}

function localError() {
  const error = Error('Локальная ошибка');
  error.name = 'LocalError';
  throw error;
}

function testErrorScope(fn) {
  try {
      try {
          fn();
      } catch (error) {
          if (error.name === 'LocalError') {
              console.log('Обнаружена локальная ошибка');
              console.error(error);
              return;
          }
          
          throw error;
      }
  } catch (error) {
      console.log('Обнаружена глобальная ошибка');
      console.error(error);
  }
}
testErrorScope(localError);
testErrorScope(globalError);



Задание 4

HTML

<!DOCTYPE html> 
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="16.6.css" />
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover">
  </head>
  <body>
    <div id="app"></div>
    <script src="16.6.js"></script>
  </body>
</html>



CSS

body {
  font-family: Arial, sans-serif;
  background-color: #f4f4f4;
  color: #333;
}

#app {
  max-width: 800px;
  margin: 0 auto;
}

.topbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #ccc;
  padding: 10px 0;
}

.topbar-logo {
  font-weight: bold;
}

.user {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.user-email {
  font-size: 12px;
}

.error {
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding: 20px;
  background: #500;
  border-radius: 12px;
  color: #fff;
  position: absolute;
}

.error-title {
  font-weight: bold;
}

.films {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  margin: 20px 0;
}

.films-card {
  border: 1px solid #ccc;
  padding: 20px;
  border-radius: 12px;
  background: #fff;
  position: relative;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.films-card[data-watched="true"] {
  background: inherit;
}

.films-card[data-watched="true"]::after {
  content: 'просмотрено';
  bottom: 4px;
  left: 20px;
  font-size: 12px;
}

.authForm {
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding: 20px 16px;
  border: 1px solid #ddd;
  background: #fff;
  border-radius: 12px;
}

.authForm input {
  padding: 10px 8px;
  border-radius: 8px;
  border: none;
  border: 1px solid #ccc;
}

.authForm-submit {
  padding: 10px 8px;
  background: #52a252;
  border: none;
  border-radius: 8px;
  color: #fff;
  margin-top: 16px;
  cursor: pointer;
}

.error.slow {
  background-color: #cb6a15;
  left: 44%;
  bottom: 55%;
  border-radius: 30px;
  height: 15px;
}

.error.network {
  background-color: #cb1515;
  left: 44%;
  bottom: 55%;
  border-radius: 30px;
  height: 15px;
}



JS

function sanitize(html) {
  const el = document.createElement('div');
  el.innerHTML = html;
  return el.textContent;
}

let user;

function setUser(userData) {
  user = userData;
}

function getUser() {
  return user;
}

async function getFilms() {
  try {
    const user = getUser();
    const response = await fetch("https://sb-film.skillbox.cc/films", {
      headers: {
        email: user?.email
      }
    });

    const data = await response.json();

    if (!response.ok) {
      handleErrorResponse(data);
    }

    return data;
  } catch (error) {
    handleError(error);
    return [];
  }
}

function handleErrorResponse(data) {
  const isNeedAuth = data.errors.some(error => error.location === 'headers' && error.param === 'email');

  if (isNeedAuth) {
    const err = new Error('Некорректный email');
    err.name = 'AuthError';
    throw err;
  }
}

function handleError(error) {
  if (error.name === 'AuthError') {
    throw error;
  }
  console.error(error);
}

function renderTopBar(user) {
  const el = document.createElement('div');
  el.classList.add('topbar');

  el.innerHTML = `
    <span class="topbar-logo">Фильмотека</span>
    <div class="topbar-user user">
      <div class="user-name">${sanitize(user.name)}</div>
      <div class="user-email">${sanitize(user.email)}</div>
    </div>
  `;

  return el;
}

function renderFilms(films) {
  const el = document.createElement('div');
  el.classList.add('films');

  if (films.length === 0) {
    el.innerText = 'Cписок фильмов пока пуст';
    return el;
  }

  films.forEach((film) => {
    const filmEl = document.createElement('div');
    filmEl.classList.add('films-card');
    filmEl.dataset.watched = film.isWatched;

    filmEl.textContent = `${film.title} (${film.releaseYear})`;

    el.append(filmEl);
  });

  return el;
}

function renderGlobalError(message) {
  const el = document.createElement('div');

  el.innerHTML = `
    <div class="error">
      <div class="error-title">Упс... Возникла ошибка</div>
      <div class="error-message">${sanitize(message)}</div>
    </error>
  `;

  return el;
}

function renderAuthForm(props) {
  const form = document.createElement('form');
  form.classList.add('authForm')

  form.innerHTML = `
    <label for="name">Ваше имя</label>
    <input id="name" type="text" name="name" required="true" placeholder="Василий" />
    <label for="email">Эл. почта</label>
    <input id="email" type="text" name="email" required="true" placeholder="example@mail.com" />
    <button class="authForm-submit"type="submit">Войти</button>
  `;

  form.addEventListener('submit', (event) => {
    event.preventDefault();

    const formData = new FormData(form);
    const formProps = Object.fromEntries(formData);

    props.onSubmit(formProps);
  });

  return form;
}

function initAuth() {
  const app = document.getElementById("app");
  app.innerHTML = '';

  app.append(renderAuthForm({
    onSubmit: (user) => {
      setUser(user);
      initApp();
    }
  }));
}

async function initApp() {
  const app = document.getElementById("app");
  app.innerHTML = '';

  try {
    const user = getUser();
    if (!user) {
      initAuth();
      return;
    }
    const films = await getFilms();
    app.append(renderTopBar(user));
    app.append(renderFilms(films));
  } catch (error) {
    console.error(error);

    if (error.name === 'AuthError') {
      initAuth();
      return;
    }

    app.append(renderGlobalError(error.message));
  }
}

initApp();

let networkCheckInterval = null;

async function checkNetwork() {
    try {
        const start = Date.now();
        const response = await fetch('https://sb-film.skillbox.cc/ping', {
            method: 'POST'
        });
        
        if (!response.ok) 
          throw new Error('Network error');
        
        const time = Date.now() - start;
        if (time > 500) {
            showNotification('Медленное соединение');
        } else {
            hideNotification();
        }
        
    } catch (error) {
        showNotification('Неполадки с сетью');
    }
}

function showNotification(text) {
    hideNotification();
    const note = document.createElement('div');
    
    let type = 'network';
    if (text.includes('Медленное')) {
        type = 'slow';
    }
    
    note.className = `error ${type}`;
    note.innerHTML = `<div class="error-message">${sanitize(text)}</div>`;
    
    document.getElementById('app')?.append(note);
    window.networkNote = note;
}

function hideNotification() {
    window.networkNote?.remove();
    window.networkNote = null;
}

checkNetwork();
networkCheckInterval = setInterval(checkNetwork, 5000);
